incarnation: scafi
environment:
  type: OSMEnvironment
  parameters: ["toronto.pbf", false]

variables:
  seed: &random
    min: 0
    max: 63
    step: 1
    default: 0
  real_devices: &real-devices
    formula: 50
  fire_stations:
    formula: 37-13
  simulated_devices: &simulated-devices
    formula: 300
  total-nodes: &total-nodes
    formula: real_devices + fire_stations + simulated_devices
  grain: &grain
    formula: 10000.0

_fire: &fire [
  [43.6952274,-79.3165712],
  [43.6690702,-79.3050117],
  [43.7774204,-79.1481339],
  [43.7204081,-79.2840196],
  [43.6998201,-79.2649478],
  [43.6958276,-79.2683603],
  [43.6801003,-79.430809],
  [43.6818629,-79.2990263],
  [43.7506185,-79.459715],
  [43.7239969,-79.2331645],
  [43.6280306,-79.502951],
  [43.7235852,-79.509764],
  [43.5477707,-79.5882463],
  [43.6192474,-79.5995469],
  [43.6608606,-79.6419355],
  [43.8137339,-79.1215924],
  [43.7007003,-79.5123407],
  [43.7892319,-79.2630374],
  [43.6841961,-79.4852713],
  [43.8239505,-79.2428632],
  [43.7954069,-79.2259766],
  [43.7740683,-79.6095286],
  [43.6923654,-79.6255347],
  [43.8154104,-79.4738316]
]

seeds:
  scenario: *random
  simulation: *random
network-model:
  type: ClosestN
  parameters: [5, *total-nodes]

_shared: &shared
  - molecule: grain
    concentration: *grain
  - molecule: dangerThr
    concentration: 0.6
_program: &program
  - time-distribution: 0.3
    type: Event
    actions:
      - type: RunScafiProgram
        parameters: [it.unibo.scafi.TorontoProgram, 5]
  - program: send

deployments:
  ##### REAL SENSOR TRACE
  - type: FromGPSTrace
    parameters: [ *real-devices, "toronto", false, "AlignToSimulationTime" ]
    programs: *program
    contents:
      shared: *shared
      costum:
        molecule: real
        concentration: true
  ##### FIRE STATION
  - type: SpecificPositions
    parameters: *fire
    programs: *program
    contents:
      shared: *shared
      costum:
        molecule: fire
        concentration: true
  ##### SIMULATED RAIN GAUGE
  - type: CloseToAlreadyDeployed
    parameters: [ *simulated-devices, 0.0002 ]
    programs: *program
    contents:
      shared: *shared

export:
  - type: CSVExporter
    parameters:
      fileNameRoot: "simulation"
      exportPath: "data"
      interval: 1
    data:
      - time
      - type: AlarmHandledByStation
      - molecule: station-busy
        value-filter: onlyfinite
        aggregators: [ sum, max ]
      - molecule: solve
        value-filter: onlyfinite
        aggregators: [ mean ]
      - molecule: water-level
        value-filter: onlyfinite
        aggregators: [ mean ]
      - molecule: total-danger
        value-filter: onlyfinite
        aggregators: [ sum ]
      - molecule: danger-1
        value-filter: onlyfinite
        aggregators: [ sum ]
      - molecule: danger-2
        value-filter: onlyfinite
        aggregators: [ sum ]
      - molecule: danger-3
        value-filter: onlyfinite
        aggregators: [ sum ]
      - molecule: danger-4
        value-filter: onlyfinite
        aggregators: [ sum ]
      - molecule: danger-5
        value-filter: onlyfinite
        aggregators: [ sum ]
      - molecule: danger-6
        value-filter: onlyfinite
        aggregators: [ sum ]
      - molecule: danger-7
        value-filter: onlyfinite
        aggregators: [ sum ]
      - molecule: danger-8
        value-filter: onlyfinite
        aggregators: [ sum ]
      - molecule: danger-9
        value-filter: onlyfinite
        aggregators: [ sum ]
      - molecule: danger-10
        value-filter: onlyfinite
        aggregators: [ sum ]

terminate:
  - type: AfterTime
    parameters: 40000